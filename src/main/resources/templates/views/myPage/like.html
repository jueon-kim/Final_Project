<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>찜한 상품</title>
    <!-- 부트스트랩 5.3.2 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <style>
        section{
            width: 1400px;
            margin: auto;
        }
        .card_wrap {
            position: relative;
        }

        .svg_wrap {
            position: absolute;
            top: 0;
            right: 0;
            padding: 7px 10px 10px;
            border: none;
        }

        .img_wrap {
            overflow: hidden;
            transition: transform 0.3s ease;
        }

        .img_wrap:hover {
            transform: scale(1.04);
        }

        .text-center h5 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: normal;
        }

    </style>
</head>
<body>
<div th:include="/views/header.html"></div>
<section>
    <div th:include="/views/sidebar.html"></div>
    <div style="width: 1100px; height: auto; float: right;">

        <h1>찜한 상품</h1>

        <div class="container px-4 mt-5 px-lg-5">
            <div class="row gx-4 gx-lg-5 row-cols-2 row-cols-md-3 row-cols-xl-4 justify-content-center">

                <div class="mb-5 col posts" th:each="post : ${likedPosts}">
                    <div class="card h-100 card_wrap">
                        <!-- Product image-->
                        <a th:href="@{/post/{postNum}(postNum=${post.post_num})}">
                            <div class="img_wrap">
                                <img class="card-img-top" src="/img/default.png" height="200" alt="..."/>
                            </div>
                        </a>
                        <!-- like svg -->
                        <input type="hidden" class="postNum" th:value="${post.post_num}">
                        <div class="svg_wrap" id="like_wrap">

                            <div th:if="${session.user != null}">
                                <button id="liked"
                                        onclick="likeProc(this)" th:attr="post_num=${post.post_num}"
                                        style="background:none; border: none">
                                    <i class="bi bi-heart-fill" style="font-size: 22px; color: red"></i>
                                </button>
                            </div>

                        </div>

                        <!-- Product details-->
                        <div class="p-4 card-body">
                            <div class="text-center">
                                <!-- Product name-->
                                <h5 th:text="${post.post_title}"></h5>
                                <!-- Product price-->
                                <h6 th:text="'가격 : '+${post.post_price}" class="fw-bolder"></h6>
                                <span id="location2" th:text="${session.user.user_location2}"></span>
                                <span>|</span>
                                <span id="regdate" th:text="${post.post_regdate}"></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- like 조작하는 스크립트 -->
<script th:inline="javascript">

    document.addEventListener('DOMContentLoaded', function () {
        const likeProc = (button) => {
            const postNum = button.getAttribute("post_num");
            console.log("postNum : " + postNum);
            $.ajax({
                type: "post",
                url: "/like",
                data: {
                    "postNum": postNum
                },
                success: function (res) {
                    console.log("res.postNum : " + res.postNum);
                    console.log("res.userNum : " + res.userNum);
                    console.log("res.likeNum : " + res.likeNum);

                    window.location.href = "/myPage/likeList";

                },
                error: function (err) {
                    console.log(err)
                }
            });
        }

        // 각각의 좋아요 버튼에 이벤트 리스너 추가
        var likeButtons = document.querySelectorAll('.svg_wrap button');
        likeButtons.forEach(function (button) {
            button.addEventListener('click', function () {
                likeProc(this);
            })
        });
    });
</script>


<!-- 제이쿼리 3.6.3 -->
<script src="https://code.jquery.com/jquery-3.6.3.min.js" integrity="sha256-pvPw+upLPUjgMXY0G+8O0xUf+/Im1MZjXxxgOcBQBXU=" crossorigin="anonymous"></script>

<!-- 파퍼 1.12.9 -->
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>

<!-- 부트스트랩 5.3.2 자바스크립트 -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>

<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-element-bundle.min.js"></script>
</body>
</html>