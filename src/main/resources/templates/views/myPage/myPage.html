<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>마이페이지</title>
    <!-- 부트스트랩 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <!-- 부트스트랩 아이콘 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <style type="text/css">
        section{
            width: 1400px;
            margin: auto;
        }
        #mypage{
            width: 850px;
            height: 210px;
            box-shadow: 0px 0px 3px 1px #FF7A6B;
            border-radius: 20px;
            padding: 30px 50px;
            margin: auto;
        }
        #mypage img{
            width: 150px;
            height: 150px;
            border-radius: 100%;
            cursor: pointer;
        }
        a{
            text-decoration: none;
            color: black;
        }

        .card_wrap {
            position: relative;
        }

        .svg_wrap {
            position: absolute;
            top: 0;
            right: 0;
            padding: 7px 10px 10px;
        }

        .img_wrap {
            overflow: hidden;
            transition: transform 0.3s ease;
        }

        .img_wrap:hover {
            transform: scale(1.04);
        }

        .text-center h5 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: normal;
        }

        .condition-dropbox ul {
            list-style-type: none;
            padding: 0;
            border: 1px solid #ccc;
            border-radius: 5px;
        }

        .condition-dropbox li {
            padding: 10px 0;
            cursor: pointer;
        }

        .condition-dropbox li a {
            text-decoration: none;
            color: #000;
        }

        .condition-dropbox li:hover {
            background-color: #f1f1f1;
        }

        .condition-dropbox ul li:nth-child(1),
        .condition-dropbox ul li:nth-child(2) {
            border-bottom: 1px solid #ccc;
        }

        .condition-dropbox {
            width: 150px;
            text-align: center;
            position: absolute;
            right: 10px;
            top: 50px;
            background-color: #fff;
        }

    </style>
</head>
<body>
<div th:include="/views/header.html"></div>
<section>
<div th:unless="${session.user != null}">로그인이 필요합니다</div>
<div th:include="/views/sidebar.html"></div>

    <div style="width: 1100px; height: auto; float: right;">

    <div id="mypage">

        <div id="" style="margin: 0 auto; line-height: 2.7rem; font-size: 20px;">
            <div style="float: left;">
                <img th:src="@{|/upload/${session.user.user_photo}|}">
            </div>

            <div style="margin-left: 60px; float: left;">
                <div style="display: flex;">
                    <div style="width: 80px; color: darkslategray;">닉네임</div>
                    <div style="margin-left: 20px; min-width: max-content; font-size: 22px; font-weight: 900;" th:text="${session.user.user_nick}"></div>
                </div>
                <div style="display: flex;">
                    <div style="width: 80px; color: darkslategray;">활동지역</div>
                    <div style="margin-left: 20px; min-width: max-content; font-size: 22px; font-weight: 900;" th:text="${session.user.user_location2}"></div>
                </div>
                <div style="display: flex;">
                    <div style="width: 80px; color: darkslategray;">에에에에</div>
                    <div style="margin-left: 20px; min-width: max-content; font-size: 22px; font-weight: 900;">으으으으</div>
                </div>
            </div>
            <div style="margin-right: 60px; float: right;">
                <div style="display: flex;">
                    <div style="width: 80px; color: darkslategray;">판매내역</div>
                    <div style="margin-left: 20px;" th:with="totalChatCount=${#lists.size(postList)}">
                        <span style="color: red; font-size: 22px; font-weight: 900;" th:text="${totalChatCount}"></span> 개
                    </div>
                </div>
                <div style="display: flex;">
                    <div style="width: 80px; color: darkslategray;">구매내역</div>
                    <div style="margin-left: 20px;">
                        <span style="color: red; font-size: 22px; font-weight: 900;">1</span> 개
                    </div>
                </div>
                <div style="display: flex;">
                    <div style="width: 80px; color: darkslategray;">찜한상품</div>
                    <div style="margin-left: 20px;">
                        <span style="color: red; font-size: 22px; font-weight: 900;">1</span> 개
                    </div>
                </div>
            </div>
        </div>
    </div>

        <div style="width:100%; height: 800px;">

            <div class="container px-4 mt-5 px-lg-5">
                <div class="row gx-4 gx-lg-5 row-cols-2 row-cols-md-3 row-cols-xl-4 justify-content-center">

                    <div class="mb-5 col" th:each="post:${postList}">
                        <a th:href="@{/post/{postNum}(postNum=${post.post_num})}">
                            <div class="card h-100 card_wrap">
                                <!-- Product image-->
                                <div class="img_wrap">
                                    <img class="card-img-top" src="/img/default.png" height="200" alt="..."/>
                                    <input type="checkbox" class="heart_checkbox" style="position: absolute; left: -99999px;">
                                </div>
                                <!-- like svg -->
                                <div class="svg_wrap">
                                    <svg class="heart_empty bi bi-heart" xmlns="http://www.w3.org/2000/svg" width="24"
                                         height="24"
                                         fill="#ccc" viewBox="0 0 16 16">
                                        <path
                                                d="m8 2.748-.717-.737C5.6.281 2.514.878 1.4 3.053c-.523 1.023-.641 2.5.314 4.385.92 1.815 2.834 3.989 6.286 6.357 3.452-2.368 5.365-4.542 6.286-6.357.955-1.886.838-3.362.314-4.385C13.486.878 10.4.28 8.717 2.01zM8 15C-7.333 4.868 3.279-3.04 7.824 1.143q.09.083.176.171a3 3 0 0 1 .176-.17C12.72-3.042 23.333 4.867 8 15"/>
                                    </svg>
                                </div>
                                <!-- like 조작하는 스크립트 -->
                                <script th:inline="javascript">
                                    document.addEventListener('DOMContentLoaded', function () {
                                        const heartDivs = document.querySelectorAll('.heart_empty');

                                        heartDivs.forEach(function(heartEmpty) {
                                            heartEmpty.addEventListener('click', function () {
                                                if (heartEmpty.classList.contains('filled')) {
                                                    heartEmpty.innerHTML = ''; // 비워진 상태
                                                    heartEmpty.classList.remove('filled');
                                                } else {
                                                    const filledSvg = `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="red" class="bi bi-heart-fill" viewBox="0 0 16 16">
                                            <path fill-rule="evenodd" d="M8 1.314C12.438-3.248 23.534 4.735 8 15-7.534 4.736 3.562-3.248 8 1.314"/>
                                        </svg>`;
                                                    heartEmpty.innerHTML = filledSvg; // 채워진 상태
                                                    heartEmpty.classList.add('filled');
                                                }
                                            });
                                        });
                                    });
                                </script>

                                <!-- Product details-->
                                <div class="p-4 card-body">
                                    <div class="text-center">
                                        <!-- Product name-->
                                        <h5 th:text="${post.post_title}"></h5>
                                        <!-- Product price-->
                                        <h6 th:text="'가격 : '+${post.post_price}" class="fw-bolder"></h6>
                                        <span id="location2" th:text="${session.user.user_location2}"></span>
                                        <span>|</span>
                                        <span id="regdate" th:text="${post.post_regdate}"></span>
                                    </div>
                                </div>
                            </div>
                        </a>
                    </div>
                </div>
            </div>
        </div>

    </div>



    <span th:text="${session.user.user_nick}"></span>




</section>
<script>
    // URL에서 success 매개변수를 확인하여 업데이트 성공 여부를 판단
    const urlParams = new URLSearchParams(window.location.search);
    const success = urlParams.get('success');

    // 업데이트 성공 시 알림창 띄우기
    if (success === 'true') {
        alert('정보가 수정되었습니다.');
    }


    function formatDate(dateString) {
        const now = new Date();
        const date = new Date(dateString);
        const diff = now - date;
        const minutes = Math.floor(diff / (1000 * 60));
        const hours = Math.floor(diff / (1000 * 60 * 60));
        const days = Math.floor(diff / (1000 * 60 * 60 * 24));
        const months = Math.floor(diff / (1000 * 60 * 60 * 24 * 30));

        if (minutes < 60) {
            return minutes + '분 전';
        } else if (hours < 24) {
            return hours + '시간 전';
        } else if (days < 30) {
            return days + '일 전';
        } else {
            return months + '달 전';
        }
    }

    document.addEventListener('DOMContentLoaded', function () {
        const regdateElements = document.querySelectorAll('#regdate');

        regdateElements.forEach(function(element) {
            var regdate = element.textContent;
            // 날짜 형식 변환 함수 호출
            var formattedDate = formatDate(regdate);
            element.textContent = formattedDate;
        });
    });

    document.addEventListener('DOMContentLoaded', function () {
        const locationElements = document.querySelectorAll('#location2');

        locationElements.forEach(function(element) {
            var location = element.textContent;
            // 띄어쓰기를 기준으로 문자열을 분리하여 두 번째 단어를 추출
            var words = location.split(' ');
            var secondWord = words.slice(1).join(' '); // 두 번째 단어부터 다시 문자열로 합침
            element.textContent = secondWord;
        });
    });

</script>

<!-- 제이쿼리 3.6.3 -->
<script src="https://code.jquery.com/jquery-3.6.3.min.js" integrity="sha256-pvPw+upLPUjgMXY0G+8O0xUf+/Im1MZjXxxgOcBQBXU=" crossorigin="anonymous"></script>

<!-- 파퍼 1.12.9 -->
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>

<!-- 부트스트랩 5.3.2 자바스크립트 -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>

<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-element-bundle.min.js"></script>

</body>
</html>