<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>판매내역</title>
    <!-- 부트스트랩 5.3.2 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <style>
        section{
            width: 1400px;
            margin: auto;
        }
        .card_wrap {
            position: relative;
        }

        .svg_wrap {
            position: absolute;
            top: 0;
            right: 0;
            padding: 7px 10px 10px;
            border: none;
        }

        .img_wrap {
            overflow: hidden;
            transition: transform 0.3s ease;
        }

        .img_wrap:hover {
            transform: scale(1.04);
        }

        .text-center h5 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: normal;
        }

        .condition-dropbox ul {
            list-style-type: none;
            padding: 0;
            border: 1px solid #ccc;
            border-radius: 5px;
        }

        .condition-dropbox li {
            padding: 10px 0;
            cursor: pointer;
        }

        .condition-dropbox li a {
            text-decoration: none;
            color: #000;
        }

        .condition-dropbox li:hover {
            background-color: #f1f1f1;
        }

        .condition-dropbox ul li:nth-child(1),
        .condition-dropbox ul li:nth-child(2) {
            border-bottom: 1px solid #ccc;
        }

        .condition-dropbox {
            width: 150px;
            text-align: center;
            position: absolute;
            right: 10px;
            top: 50px;
            background-color: #fff;
        }

    </style>
</head>
<body>
<div th:include="/views/header.html"></div>
<section>
    <div th:include="/views/sidebar.html"></div>

    <div style="width: 1100px; height: auto; float: right;">

        <div style="width:100%; height: 800px; background-color: lightblue; display: none">
            <h1>판매내역</h1>
            <span th:text="${session.user.user_nick}"></span>

            <div th:each="post : ${postList}">
                <table th:text="${post}"></table>
                <!-- 채팅하기 버튼, user_num을 파라미터로 전달 -->
                <a th:href="@{/chat/{userNum}(userNum=${post.user_num})}">
                    <button>채팅하기</button>
                </a>
            </div>
        </div>



    <div style="width:100%; height: 800px; background-color: lightblue;">
        <h1>판매내역</h1>

        <div class="container px-4 mt-5 px-lg-5">
            <div class="row gx-4 gx-lg-5 row-cols-2 row-cols-md-3 row-cols-xl-4 justify-content-center">


                <div class="mb-5 col" th:each="post:${postList}">

                    <div class="card h-100 card_wrap">
                        <!-- Product image-->
                        <a th:href="@{/post/{postNum}(postNum=${post.post_num})}">
                            <div class="img_wrap">
                                <img class="card-img-top" src="./img/like_u.png" height="200" alt="..." />
                            </div>
                        </a>
                        <div class="condition-dropbox" style="display: none;">
                            <ul>
                                <li><a href="#">상품수정</a></li>
                                <li><a href="#">상태변경</a></li>
                                <li><a href="#">상품삭제</a></li>
                            </ul>
                        </div>
                        <!-- dropbox li의 배경을 클릭해도 a태그로 감싼 텍스트를 누른것처럼 동작하게 하는 스크립트  -->
                        <script>
                            document.addEventListener('DOMContentLoaded', function () {
                                const dropboxItems = document.querySelectorAll('.condition-dropbox ul li');

                                dropboxItems.forEach(function (item) {
                                    item.addEventListener('click', function () {
                                        const href = item.querySelector('a').getAttribute('href');
                                        if (href) {
                                            window.location.href = href;
                                        }
                                    });
                                });
                            });

                        </script>
                        <!--dot svg -->
                        <div class="svg_wrap">
                            <svg id="dots_svg" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="#ccc"
                                 class="bi bi-three-dots-vertical" viewBox="0 0 16 16">
                                <path
                                        d="M9.5 13a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0m0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0m0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0" />
                            </svg>
                        </div>

                        <!-- Product details-->
                        <div class="p-4 card-body">
                            <div class="text-center">
                                <!-- Product name-->
                                <h5 th:text="${post.post_title}"></h5>
                                <!-- Product price-->
                                <h6 th:text="'가격 : '+${post.post_price}" class="fw-bolder"></h6>
                                <span id="location2" th:text="${session.user.user_location2}"></span>
                                <span>|</span>
                                <span id="regdate" th:text="${post.post_regdate}"></span>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    </div>
</section>

<!-- 더보기 스크립트 -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const dotsSvg = document.getElementById('dots_svg');
        const originalSvg = dotsSvg.cloneNode(true);
        const newSvg = `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#ccc" class="bi bi-x-lg" viewBox="0 0 16 16">
                                            <path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8z"/>
                                        </svg>`;
        let isClicked = false;

        dotsSvg.addEventListener('click', function () {
            if (isClicked) {
                //드롭박스 기본 컨디션 정의
                dotsSvg.innerHTML = originalSvg.innerHTML;
                document.querySelector('.condition-dropbox').style.display = 'none';
            } else {
                //svg 누르면 드롭박스 ui div가 나타나도록 함
                dotsSvg.innerHTML = newSvg;
                document.querySelector('.condition-dropbox').style.display = 'block';
            }
            isClicked = !isClicked;
        });
    });
</script>

<script th:inline="javascript">
    document.addEventListener('DOMContentLoaded', function () {
        const regdateElements = document.querySelectorAll('#regdate');

        regdateElements.forEach(function(element) {
            var regdate = element.textContent;
            // YYYY-MM-DD 형식으로 변경
            var formattedDate = new Date(regdate).toISOString().slice(0, 10);
            element.textContent = formattedDate;
        });
    });

    document.addEventListener('DOMContentLoaded', function () {
        const locationElements = document.querySelectorAll('#location2');

        locationElements.forEach(function(element) {
            var location = element.textContent;
            // 띄어쓰기를 기준으로 문자열을 분리하여 두 번째 단어를 추출
            var words = location.split(' ');
            var secondWord = words.slice(1).join(' '); // 두 번째 단어부터 다시 문자열로 합침
            element.textContent = secondWord;
        });
    });

</script>

<!-- 제이쿼리 3.6.3 -->
<script src="https://code.jquery.com/jquery-3.6.3.min.js" integrity="sha256-pvPw+upLPUjgMXY0G+8O0xUf+/Im1MZjXxxgOcBQBXU=" crossorigin="anonymous"></script>

<!-- 파퍼 1.12.9 -->
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>

<!-- 부트스트랩 5.3.2 자바스크립트 -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>

<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-element-bundle.min.js"></script>
</body>
</html>