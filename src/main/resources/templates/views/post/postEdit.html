<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <title>ê¸€ëª©ë¡</title>

    <style>
        section {
            width: 1400px;
            margin: auto;
        }
    </style>
</head>
<body>
<div th:include="/views/header"></div>
<section th:each="edit : ${postEdit}">

    <form action="/post/edit" method="post" onsubmit="updateDate()" enctype="multipart/form-data">

        <div style="width: 768px; margin: auto">
            <br>

            <!-- ì‚¬ì§„ ë“¤ì–´ê°ˆê³³ -->
            <div style="display: flex; padding: 0 40px 20px 40px;">
                <div style="padding: 15px;">
                    <label for="post_upLoadFile" class="btn btn-outline-dark" style="width: 80px; height: 80px;"><i
                            class="bi bi-camera" style="font-size: 30px;"></i>
                        <p style="font-size: 12px;">ìµœëŒ€ 5ì¥</p></label>
                    <input type="file" accept="image/jpeg, image/png" name="post_upLoadFile" id="post_upLoadFile"
                           style="display: block;" multiple onchange="file(event)">
                </div>
                <div style="width: 700px; display: flex; justify-content: flex-start" id="uploadedImages">
                    <div th:each="index : ${#numbers.sequence(0, edit.file_url.size() - 1)}">
                        <img th:id="'thumbnail_' + ${index}" th:src="@{|/upload/${edit.file_url[__${index}__]}|}"
                             style="width: 80px; height: 80px; margin: 15px; box-shadow: 0px 0px 8px -1px;
                              border-radius: 8px; cursor: pointer" th:onclick="'extend('+ ${index} +')'"
                             th:onmouseover="'extend('+ ${index} +')'">
                    </div>
                </div>
            </div>
            <br>

            <div>
                <input id="postTitle" name="post_title" th:value="${edit.post_title}" class="form-control" required
                       minlength="4" maxlength="50" style="width: 768px;">
            </div>
            <br>

            <div>
                <select class="form-select" name="category_num" aria-label="Default select example"
                        th:value="${edit.category_num}">
                    <option value="1" th:selected="${edit.category_num == 1}">ì—¬ì„±ì˜ë¥˜</option>
                    <option value="2" th:selected="${edit.category_num == 2}">ë‚¨ì„±ì˜ë¥˜</option>
                    <option value="3" th:selected="${edit.category_num == 3}">ì‹ ë°œ</option>
                    <option value="4" th:selected="${edit.category_num == 4}">ê°€ë°©/ì§€ê°‘</option>
                    <option value="5" th:selected="${edit.category_num == 5}">ì‹œê³„</option>
                    <option value="6" th:selected="${edit.category_num == 6}">ì¥¬ì–¼ë¦¬</option>
                    <option value="7" th:selected="${edit.category_num == 7}">íŒ¨ì…˜ ì•¡ì„¸ì„œë¦¬</option>
                    <option value="8" th:selected="${edit.category_num == 8}">ë””ì§€í„¸</option>
                    <option value="9" th:selected="${edit.category_num == 9}">ê°€ì „ì œí’ˆ</option>
                    <option value="10" th:selected="${edit.category_num == 10}">ìŠ¤í¬ì¸ /ë ˆì €</option>
                    <option value="11" th:selected="${edit.category_num == 11}">ì°¨ëŸ‰/ì˜¤í† ë°”ì´</option>
                    <option value="12" th:selected="${edit.category_num == 12}">ìŠ¤íƒ€êµ¿ì¦ˆ</option>
                    <option value="13" th:selected="${edit.category_num == 13}">í‚¤ëœíŠ¸</option>
                    <option value="14" th:selected="${edit.category_num == 14}">ì˜ˆìˆ /í¬ê·€/ìˆ˜ì§‘í’ˆ</option>
                    <option value="15" th:selected="${edit.category_num == 15}">ìŒë°˜/ì•…ê¸°</option>
                    <option value="16" th:selected="${edit.category_num == 16}">ë„ì„œ/í‹°ì¼“/ë¬¸êµ¬</option>
                    <option value="17" th:selected="${edit.category_num == 17}">ë·°í‹°/ë¯¸ìš©</option>
                    <option value="18" th:selected="${edit.category_num == 18}">ê°€êµ¬/ì¸í…Œë¦¬ì–´</option>
                    <option value="19" th:selected="${edit.category_num == 19}">ìƒí™œ/ì£¼ë°©ìš©í’ˆ</option>
                    <option value="20" th:selected="${edit.category_num == 20}">ê³µêµ¬/ì‚°ì—…ìš©í’ˆ</option>
                    <option value="21" th:selected="${edit.category_num == 21}">ì‹í’ˆ</option>
                    <option value="22" th:selected="${edit.category_num == 22}">ìœ ì•„ë™/ì¶œì‚°</option>
                    <option value="23" th:selected="${edit.category_num == 23}">ë°˜ë ¤ë™ë¬¼ìš©í’ˆ</option>
                    <option value="24" th:selected="${edit.category_num == 24}">ê¸°íƒ€</option>
                </select>
            </div>
            <br>


            <!-- ê¸€ë‚´ìš© -->
            <div>
                <textarea id="post_content" name="post_content" class="form-control"
                          placeholder="- ìƒí’ˆëª…(ë¸Œëœë“œ)&#10;- êµ¬ë§¤ ì‹œê¸°&#10;- ì‚¬ìš© ê¸°ê°„&#10;- í•˜ì ì—¬ë¶€&#10;* ì‹¤ì œ ì´¬ì˜í•œ ì‚¬ì§„ê³¼ í•¨ê»˜ ìƒì„¸ ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.&#10;* ì¹´ì¹´ì˜¤í†¡ ì•„ì´ë”” ì²¨ë¶€ ì‹œ ê²Œì‹œë¬¼ ì‚­ì œ ë° ì´ìš©ì œì¬ ì²˜ë¦¬ë  ìˆ˜ ìˆì–´ìš”.&#10;ì•ˆì „í•˜ê³  ê±´ì „í•œ ê±°ë˜í™˜ê²½ì„ ìœ„í•´ ê³¼í•™ê¸°ìˆ ì •ë³´í†µì‹ ë¶€, í•œêµ­ì¸í„°ë„·ì§„í¥ì›, ì¤‘ê³ ë‚˜ë¼ê°€ í•¨ê»˜í•©ë‹ˆë‹¤."
                          style="width: 768px; height: 200px;" maxlength="1000"
                          th:text="${edit.post_content}"></textarea>
            </div>
            <br>

            <!--ê°€ê²© -->
            <div>
                <input id="post_price" name="post_price" class="form-control" placeholder="ğŸ’²íŒë§¤ê°€ê²©(ìˆ«ìë§Œ ì…ë ¥í•˜ì„¸ìš”)"
                       th:value="${edit.post_price}"
                       onKeyup="this.value=this.value.replace(/[^0-9]/g,'')">
            </div>
            <br>

            <div>
                <p>
                    <select class="form-select" name="post_saleState" aria-label="Default select example">
                        <option th:selected="${edit.post_saleState == 'íŒë§¤ì¤‘'}">íŒë§¤ì¤‘</option>
                        <option th:selected="${edit.post_saleState == 'ì˜ˆì•½ì¤‘'}">ì˜ˆì•½ì¤‘</option>
                        <option th:selected="${edit.post_saleState == 'íŒë§¤ì™„ë£Œ'}">íŒë§¤ì™„ë£Œ</option>
                    </select>
                </p>
            </div>
            <div>
                <p style="font-size: 20px;">ê±°ë˜ì¥ì†Œ</p>
                <input type="radio" class="btn-check" name="post_productState" id="used" autocomplete="off" value="ì¤‘ê³ "
                       th:checked="${edit.post_productState == 'ì¤‘ê³ '}">
                <label class="btn btn-outline-success" for="used">ì¤‘ê³ </label>

                <input type="radio" class="btn-check" name="post_productState" id="new" autocomplete="off" value="ìƒˆìƒí’ˆ"
                       th:checked="${edit.post_productState == 'ìƒˆìƒí’ˆ'}">
                <label class="btn btn-outline-success" for="new">ìƒˆìƒí’ˆ</label>
            </div>
            <br>


            <div>
                <p style="font-size: 20px;">ê±°ë˜ì¥ì†Œ</p>
                <input type="radio" class="btn-check" name="post_way" id="direct" autocomplete="off" value="ì§ê±°ë˜"
                       th:checked="${edit.post_way == 'ì§ê±°ë˜'}">
                <label class="btn btn-outline-success" for="direct">ì§ê±°ë˜</label>

                <input type="radio" class="btn-check" name="post_way" id="post" autocomplete="off" value="íƒë°°"
                       th:checked="${edit.post_way == 'íƒë°°'}">
                <label class="btn btn-outline-success" for="post">íƒë°°</label>

                <input type="radio" class="btn-check" name="post_way" id="both" autocomplete="off" value="ì§ê±°ë˜, íƒë°°"
                       th:checked="${edit.post_way == 'ì§ê±°ë˜, íƒë°°'}">
                <label class="btn btn-outline-success" for="both">ì§ê±°ë˜, íƒë°°</label>
            </div>
            <br>


            <div style="width: 768px;">
                <p style="font-size: 20px;">ê±°ë˜ì¥ì†Œ</p>
                <input class="form-control" id="location2" name="post_location2" th:value="${session.user.user_location2}" onclick="openZipSearch()">
                </div>
            </div><br>

            <div id="map" style="width: 764px; height: 500px; border-radius: 15px;"><br><br>
        </div>

        <div class="d-none">
            <input class="form-control" id="location" name="post_location" th:value="${session.user.user_location}" onclick="openZipSearch()">
            <input name="post_num" th:value="${edit.post_num}">
            <input name="post_regdate" th:value="${edit.post_regdate}">
            <input name="post_update" id="post_update" th:value="${edit.post_update}">
            <input name="post_hits" th:value="${edit.post_hits}">
            <input class="hidden-field" th:value="${session.user.user_num}" name="user_num" id="user_num">
        </div>

        <div style="display: flex; justify-content: center">
            <button type="submit" class="btn btn-outline-secondary" id="joinButton">ìˆ˜ì •</button>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <a class="btn btn-outline-danger" href="#" onclick="confirmed()">ì·¨ì†Œ</a>
        </div>


        <footer>
            <div th:include="/views/footer.html"></div>
        </footer>
        </div>

    </form>

</section>


<script>
    function updateDate() {
        var now = new Date();
        var year = now.getFullYear();
        var month = String(now.getMonth() + 1).padStart(2, '0');
        var day = String(now.getDate()).padStart(2, '0');
        var hours = String(now.getHours()).padStart(2, '0');
        var minutes = String(now.getMinutes()).padStart(2, '0');
        var seconds = String(now.getSeconds()).padStart(2, '0');
        // return year + '-' + month + '-' + day + ' ' + hours + ':' + minutes + ':' + seconds;

        document.getElementById("post_update").value = year + '-' + month + '-' + day + ' ' + hours + ':' + minutes + ':' + seconds;
    }


    // ìµœëŒ€ ì—…ë¡œë“œ íŒŒì¼ ìˆ˜
    const maxFiles = 5;

    function file(event) {
        const files = event.target.files; // ì„ íƒëœ íŒŒì¼ ê°€ì ¸ì˜¤ê¸°
        const uploadedImagesDiv = document.getElementById("uploadedImages");

        // ì—…ë¡œë“œëœ íŒŒì¼ì„ í™”ë©´ì— í‘œì‹œ
        uploadedImagesDiv.innerHTML = ""; // ì´ì „ì— ì—…ë¡œë“œëœ ì´ë¯¸ì§€ë“¤ ì´ˆê¸°í™”

        if (files.length > maxFiles) {
            alert(`ìµœëŒ€ ${maxFiles}ê°œê¹Œì§€ ì—…ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`);
            event.target.value = ""; // íŒŒì¼ ì„ íƒ ì·¨ì†Œ
        } else if (files.length > 0) {
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                console.log(`File ${i + 1}:`);
                console.log("File name:", file.name); // íŒŒì¼ ì´ë¦„ ì¶œë ¥
                console.log("File size:", file.size, "bytes"); // íŒŒì¼ í¬ê¸° ì¶œë ¥
                console.log("File type:", file.type); // íŒŒì¼ ìœ í˜• ì¶œë ¥

                // ì´ë¯¸ì§€ ì—˜ë¦¬ë¨¼íŠ¸ ìƒì„±
                const img = document.createElement("img");
                img.src = URL.createObjectURL(file);
                img.style.width = "80px"; // ì´ë¯¸ì§€ ë„ˆë¹„ ì¡°ì ˆ
                img.style.height = "80px"; // ì´ë¯¸ì§€ ë„ˆë¹„ ì¡°ì ˆ
                img.style.margin = "15px"; // ì´ë¯¸ì§€ ê°„ê²© ì¡°ì ˆ
                img.style.boxShadow = "0px 0px 8px -1px"; // ì´ë¯¸ì§€ ê°„ê²© ì¡°ì ˆ
                img.style.borderRadius = "8px;";


                // ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œëœ ì´ë¯¸ì§€ë“¤ì„ í‘œì‹œí•˜ëŠ” divì— ì¶”ê°€
                uploadedImagesDiv.appendChild(img);
            }
        } else {
            console.log("No file selected");
        }
    }
</script>

<script>
    // í˜ì´ì§€ ë¡œë“œ ì‹œ initMap í•¨ìˆ˜ ì‹¤í–‰
    window.onload = function () {
        initializeMap();
    };
    // ì§€ë„ ê´€ë ¨ í•¨ìˆ˜
    var map; // ì§€ë„ ê°ì²´ë¥¼ ì €ì¥í•˜ëŠ” ë³€ìˆ˜
    var marker; // ë§ˆì»¤ ê°ì²´ë¥¼ ì €ì¥í•˜ëŠ” ë³€ìˆ˜

    // ì£¼ì†Œë¥¼ ê²€ìƒ‰í•˜ì—¬ ì§€ë„ì— í‘œì‹œí•˜ëŠ” í•¨ìˆ˜
    function initializeMap() {
        var addr = document.getElementById('location').value; // ì…ë ¥ëœ ì£¼ì†Œ ê°€ì ¸ì˜¤ê¸°
        var geocoder = new kakao.maps.services.Geocoder(); // ì£¼ì†Œ ê²€ìƒ‰ ê°ì²´ ìƒì„±


        // ì£¼ì†Œ ê²€ìƒ‰ ìš”ì²­
        geocoder.addressSearch(addr, function (result, status) {
            if (status === kakao.maps.services.Status.OK) {
                // ê²€ìƒ‰ëœ ì£¼ì†Œì˜ ì¢Œí‘œë¡œ ì§€ë„ ì´ˆê¸°í™”
                var coords = new kakao.maps.LatLng(result[0].y, result[0].x);

                // ì§€ë„ ì˜µì…˜ ì„¤ì •
                var mapContainer = document.getElementById('map');
                var mapOptions = {
                    center: coords, // ì§€ë„ ì¤‘ì‹¬ ì¢Œí‘œ ì„¤ì •
                    level: 5// ì§€ë„ í™•ëŒ€ ìˆ˜ì¤€ ì„¤ì •
                };
                // ì§€ë„ ê°ì²´ ìƒì„±
                map = new kakao.maps.Map(mapContainer, mapOptions);

                // ìƒˆë¡œìš´ ë§ˆì»¤ ìƒì„±
                marker = new kakao.maps.Marker({
                    position: coords,
                    map: map
                });
            }
        });
        // ì¢Œí‘œë¥¼ ì£¼ì†Œë¡œ ë³€í™˜
        var geocoder = new kakao.maps.services.Geocoder();
        geocoder.coord2Address(center.getLng(), center.getLat(), function(result, status) {
            if (status === kakao.maps.services.Status.OK) {
                // ì£¼ì†Œë¥¼ ì–»ì–´ì˜´
                var address = result[0].address.address_name;
                var parts = address.split(" ");
                var extractedAddress = parts.slice(1, 3).join(" ");
                console.log("í˜„ì¬ ì„ íƒí•œ ì¢Œí‘œì˜ ëª¨ë“ ì£¼ì†Œ: " + address);
                console.log("í˜„ì¬ ì„ íƒí•œ ì¢Œí‘œì˜ ì£¼ì†Œ: " + extractedAddress);
                $("#location").val(address); // ì£¼ì†Œë¥¼ ì…ë ¥ë€ì— ì±„ì›€
                $("#location2").val(extractedAddress); // ì£¼ì†Œë¥¼ ì…ë ¥ë€ì— ì±„ì›€
            }
        });
    }




</script>
<script>
    function openZipSearch() {
        new daum.Postcode({
            oncomplete: function(data) {
                var addr;
                if (data.jibunAddress) {
                    addr = data.jibunAddress;
                } else if (data.autoJibunAddress) {
                    addr = data.autoJibunAddress;
                } else {
                    // ì£¼ì†Œ ì •ë³´ê°€ ì—†ëŠ” ê²½ìš°ì— ëŒ€í•œ ì²˜ë¦¬
                    addr = "ì£¼ì†Œ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.";
                }
                var addr2 = data.sigungu + " " + data.bname;
                console.log("ê²€ìƒ‰ëœ ì§€ë²ˆì£¼ì†Œ:" +addr);
                console.log("ê²€ìƒ‰ëœ êµ¬+ë™ ì£¼ì†Œ:" +addr2);

                $("#location").val(addr);
                $("#location2").val(addr2);

                //ì•„ë˜ì— ì§€ì •í•œ í•¨ìˆ˜ ë°”ë¡œ ë¶ˆëŸ¬ì˜¤ê¸°
                searchAddress();

            }
        }).open();
    }



    //ì£¼ì†Œë¥¼ ì¢Œí‘œë¡œ ë³€í™˜ í›„ ì§€ë„ í‘œì‹œí•˜ê¸°
    function searchAddress() {
        //user_locationì— ì…ë ¥ëœ ê°’ ê°€ì ¸ì˜¤ê¸°
        var addr = document.getElementById('location').value;
        // ì¥ì†Œ ê²€ìƒ‰ ê°ì²´ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
        var geocoder = new kakao.maps.services.Geocoder();

        // ì£¼ì†Œë¡œ ì¢Œí‘œë¥¼ ê²€ìƒ‰í•©ë‹ˆë‹¤.
        geocoder.addressSearch(addr, function(result, status) {
            // ì •ìƒì ìœ¼ë¡œ ê²€ìƒ‰ì´ ì™„ë£Œëìœ¼ë©´
            if (status === kakao.maps.services.Status.OK) {
                var coords = new kakao.maps.LatLng(result[0].y, result[0].x);

                // ì§€ë„ ì¤‘ì‹¬ì„ ê²€ìƒ‰ëœ ì¢Œí‘œë¡œ ì´ë™ì‹œí‚µë‹ˆë‹¤.
                map.setCenter(coords);

                // ë§ˆì»¤ë¥¼ ìƒì„±í•˜ê³  ì§€ë„ ìœ„ì— í‘œì‹œí•©ë‹ˆë‹¤.
                marker.setPosition(coords);
            } else {
                alert('ê²€ìƒ‰ì— ì‹¤íŒ¨í•˜ì˜€ìŠµë‹ˆë‹¤.');
            }
        });
    }
</script>
</body>
</html>